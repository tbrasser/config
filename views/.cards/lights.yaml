# lovelace_gen
{% for room in _global.rooms %}
{% for light in room.lights %}
{% if light.type == 'onoff' %}
- type: tile
  entity: "{{ light.entity }}"
  show_entity_picture: false
  name: "{{ room.name|capitalize }} {{ light.name|capitalize }}"
{% else %}
- type: custom:vertical-stack-in-card
  cards:
    - type: tile
      entity: "{{ light.entity }}"
      show_entity_picture: false
      name: "{{ room.name|capitalize }} {{ light.name|capitalize }}"
      card_mod:
{% raw %}
        style: |
          ha-card {
            background: none;
            box-shadow: none;
            {% if is_state(config.entity, 'on') %}
            {% set r = state_attr(config.entity, 'rgb_color')[0] %}
            {% set g = state_attr(config.entity, 'rgb_color')[1] %}
            {% set b = state_attr(config.entity, 'rgb_color')[2] %}
            --primary-text-color: rgb({{r}}, {{g}}, {{b}});
            --secondary-text-color: rgba({{r}}, {{g}}, {{b}},0.5);
            {% endif %}
          }
          ha-tile-icon {
            {% if is_state(config.entity, 'on') %}
            --icon-color: rgb({{r}}, {{g}}, {{b}}) !important;
            --shape-color: rgba({{r}}, {{g}}, {{b}},0.2) !important;
            {% endif %}
          }
{% endraw %}
    - type: conditional
      conditions:
        - entity: "{{ light.entity }}"
          state: 'on'
      card:
        type: custom:mushroom-light-card
        entity: "{{ light.entity }}"
        use_light_color: true
        show_brightness_control: true
        {% if light.type == 'rgb' %}
        show_color_temp_control: false
        show_color_control: true
        {% endif %}
        {% if light.type == 'cct' %} 
        show_color_temp_control: true
        show_color_control: false
        {% endif %}
        {% if light.type == 'dimmable' %}
        show_color_temp_control: false
        show_color_control: false
        {% endif %}
        collapsible_controls: false
        fill_container: true
        icon_type: none
        primary_info: none
        secondary_info: none
        double_tap_action:
          action: toggle
        tap_action:
          action: more-info
        hold_action:
          action: navigate
          navigation_path: /lovelace/{{ room.name }}
{% raw %}
        card_mod:
          style: |
            ha-card {
              margin-top: -15px;
              background: none;
              box-shadow: none;
              {% if is_state(config.entity, 'on') %}
              --primary-text-color: rgb({{ state_attr(config.entity,'rgb_color') [0] }}, {{ state_attr(config.entity,'rgb_color') [1] }}, {{ state_attr(config.entity,'rgb_color') [2] }});
              {% endif %}
              }
            }
{% endraw %}
  card_mod:
    style: |
      ha-card {
        {{ "{%" }} if is_state('{{ light.entity }}', 'on') {{ "%}" }}
            background: rgba({{ "{{" }} state_attr('{{ light.entity }}','rgb_color') [0] {{ "}}" }},
                    {{ "{{" }} state_attr('{{ light.entity }}','rgb_color') [1] {{ "}}" }},
                    {{ "{{" }} state_attr('{{ light.entity }}','rgb_color') [2] {{ "}}" }},0.1);
        {{ "{%" }} endif {{ "%}" }}
      }
{% endif %}
{% endfor %}
{% endfor %}